# ----- Header -----
__schema__ = "tasker.launcher.Launcher"
__name__ = "Basic Template of training script of NAIC 2020 Remore Sense"
__author__ = "Chen Runze"
__version__ = "0.0.1"
__email__ = "chenrz925@bupt.edu.cn"
__abstract__ = ""

# ----- Launcher Settings -----
[__setting__]
    [__setting__.log]
        [__setting__.log.console]
        class = 'logging.StreamHandler'
        formatter = 'default'
        level = 'INFO'
        stream = 'ext://sys.stdout'
        [__setting__.log.file]
        class = 'logging.FileHandler'
        formatter = 'default'
        level = 'DEBUG'
        filename = '.tasker/log/naic2020rs-basic-model-training.log' # File path here should be modified to train other models.
    [__setting__.storage]
    reference = "tasker.storages.vanilla.HardPickleStorage"
    kwargs = []

# ----- Tasks to Launch -----

[[__meta__]]
reference = "tasker.tasks.utils.SetEnvironmentTask"
include = false
path = ""
profile = "env"
execute = true

[[__meta__]]
reference = "datasets.naic2020rs.NAIC2020RSDataLoaderTask:train"
include = false
path = ""
profile = "train_loader"
execute = true

[[__meta__]]
reference = "datasets.naic2020rs.NAIC2020RSDataLoaderTask:validate"
include = false
path = ""
profile = "validate_loader"
execute = true

[[__meta__]]
reference = "models.naic2020rs.basic.NAIC2020RSModelTrainTask"
include = false
path = ""
profile = "model"
execute = true

# -----

[env]
env = [
    ["CUDA_VISIBLE_DEVICES", "3,6,7"]
]

[train_loader]
sampler_type = "batch_sampler"
    [train_loader.dataset]
    reference = 'datasets.naic2020rs.NAIC2020RS'
        [train_loader.dataset.kwargs]
        root_dir = '/public/lhy/crz/datasets/naic2020_rs'
        train = true
        ratio = 0.9
    [train_loader.loader]
    batch_size = 256
    shuffle = true
    num_workers = 32
    pin_memory = true
    drop_last = false

[validate_loader]
sampler_type = "batch_sampler"
    [validate_loader.dataset]
    reference = 'datasets.naic2020rs.NAIC2020RS'
        [validate_loader.dataset.kwargs]
        root_dir = '/public/lhy/crz/datasets/naic2020_rs'
        train = false
        ratio = 0.9
    [validate_loader.loader]
    batch_size = 256
    shuffle = true
    num_workers = 32
    pin_memory = true
    drop_last = false

[model]
device = "cuda:0"
non_blocking = false
max_epochs = 20
    [model.model]
    # Insert configurations of your model here.
    [model.optimizer]
    reference = "torch.optim.AdamW"
        [model.optimizer.kwargs]
        lr = 1e-4
        amsgrad = true
    [model.loss]
    reference = "torch.nn.CrossEntropyLoss"
        [model.loss.kwargs]